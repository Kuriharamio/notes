# 安装 Python 环境

## Windows

### 1、安装 Python环境，建议“Python 3.11”

### 2、设置 powershell 的执行权限

1. 在开始菜单找到 PowerShell，右键单击选择 “使用管理员打开”
   1. ![image-20240319233521328](C:\Users\13618\AppData\Roaming\Typora\typora-user-images\image-20240319233521328.png)
2. 在 PowerShell 命令行，输入 `Set-ExecutionPolicy RemoteSigned` ，然后提示都选 `Y` ，打开执行权限
3. ![image-20240319233545279](C:\Users\13618\AppData\Roaming\Typora\typora-user-images\image-20240319233545279.png)

在 Windows 上更换 python 版本，可以通过多种方法实现。推荐使用Anaconda配置python环境，可以方便的管理系统库依赖以及管理不同的python版本。下面是详细的步骤：

### 3、安装Anaconda

1.  [下载安装程序](https://www.anaconda.com/download) 

2. 运行安装程序：可选自动配置环境变量，也可手动配置。将 `C:\Users\<用户名>\anaconda3\Scripts` 配置到环境变量 `Path` 中，安装后在命令行中运行 `conda  --version` 如无报错即可

3. windows server 2022，conda23.7.4中，默认路径是：C:\ProgramData\anaconda3\Scripts

   

### 4、使用conda创建python环境

1. 创建环境

2. ```Bash
   # 创建名为agiclass的python3.9环境
   conda create -n agiclass python=3.9
   # 创建成功后可以查看现有环境
   conda env list
   # 初始化命令行设置
   conda init powershell
   # 进入已创建的环境
   conda activate agiclass
   ```

3. 切换python版本：可另外创建一个环境，-n 参数后是制定的名字，python= 后面接需要的版本如3.11，并activate对应名字的环境即可生效

   

### 5、配置国内 pip 源

1. pip定义：Python 的包管理工具，用于安装和管理额外的库和依赖。通常情况下，Python 安装时会自动包含 pip
2. 解决安装包依赖网络
3.  [参考配置 pip 源](https://mirrors.tuna.tsinghua.edu.cn/help/pypi/) 
4. ```Bash
   python -m pip install --upgrade pip
   pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
   ```

### 6、配置 python utf-8 模式

默认情况下 python 读取文件等都是使用 windows 默认的 `gbk` 的编码格式，现在的文档一般是 `utf-8` 格式的，所以需要将 python 设置为 `utf-8` 模式

1. 通过开始菜单进入配置

2. 搜索环境变量，然后按照下图配置好环境变量  `PYTHONUTF8` , 值为 `1`

3. 重启电脑，让这个环境变量生效

   

## Mac

1. 通过 Homebrew 安装 Python**，**确保已经安装 “Homebrew”，并在在终端运行如下代码
   1. 打开终端方式：command+空格→终端
      1. 最好操作系统（MacOS）已更新到最新
      2. 确认电脑已可以“翻墙”，在执行如下代码
      3. ```Bash
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
         ```
   2. 运行如下代码后，会提示输入“Password”（电脑开机密码）
   3. 输入密码后，预计会安装5-10分钟
   4. “分别”复制两段代码（Next steps开头的）
2. 系统 Python：避免更改或删除系统自带的 Python，因为 macOS 的某些组件依赖于它
3. 使用 Homebrew 安装 Python

```Bash
brew install python3
```

1. 在终端运行如下代码，验证是否安装成功

```Bash
brew install python3
```

1. 切换 Python 版本

介绍：在 Mac 上更换 Python 版本可以通过多种方法来实现。其中常用的方法有两种“Homebrew、pyenv”，这两种方法都允许你在系统上安装多个版本的 Python，并在它们之间切换。

1. Homebrew 更换
   1. **安装新版本的 Python:**
      1. 查看当前最新版本
      2. ```Bash
         brew install python3
         ```

      3. Homebrew 安装新版本的 Python，打开终端并输入
      4. ```Bash
         brew install python@3.9.2
         ```
   2. 链接 Python 版本**（**安装完成后，你可能需要将最新版本的 Python 链接到你的路径。例如：对 Python `3.9.2`，你会运行如下代码
   3. ```Bash
      brew link --overwrite python@3.9.2
      ```

   4. 查看最新版本是否安装成功
   5. ```Bash
      python3 -V
      ```
2. pyenv 更换 
   1. 安装 pyenv 可以通过 Homebrew 安装
   2. ```Bash
      brew update
      brew install pyenv
      ```

   3. 配置 pyenv查看自己是什么用户：ps -p $$
      1. 安装后，需要在你的 shell 配置文件中添加初始化代码。对于 bash 用户，在 ~/.bash_profile 中运行如下代码
      2. ```Bash
         eval "$(pyenv init --path)"
         ```

      3. 安装后，需要在你的 shell 配置文件中添加初始化代码。对于 zsh 用户，在 ~/.zshrc 中运行如下代码
      4. ```Bash
         eval "$(pyenv init --path)"
         ```
   4. 使用 pyenv 安装新版本的 Python。如：安装 Python 3.9.2，运行如下代码
   5. ```Bash
      pyenv install 3.9.2
      ```

   6. 通过 pyenv 设置全局 Python 版本
   7. ```Bash
      pyenv global 3.9.2
      ```

   8. 验证新版本是否设置成功，运行如下代码
   9. ```Bash
      python --version
      ```
3. 注意事项
   1. 重新加载 Shell：在修改配置文件后，确保重新加载 shell，关闭并重新打开终端，运行如下代码（二选一）
   2. ```Bash
      source ~/.bash_profile
      ```

   3. ```Bash
      source ~/.zshrc
      ```

   4. 版本管理：使用 pyenv 时，可以轻松地在不同版本的 Python 之间切换



## pip

### 1、简介

pip 是 Python 的包管理工具，它是 Python 社区用于安装和管理第三方库和依赖的标准方法。使用 pip 可以安装、卸载、升级和管理 Python 包。

通过 pip ，可以轻松地获取和安装这些包，以供 Python 项目使用。

应用的场景（包括但不限于）

pip 可以下载和安装各种第三方库，例如 numpy、pandas、matplotlib 等。这些库提供了各种功能，可以帮助开发人员快速实现数据处理、可视化、网络通信等任务。

升级已安装的包：使用 pip 可以方便地升级已安装的包到最新版本，以获取最新的功能和修复。

使用 pip 可以搜索 PyPI 上的可用包，找到满足特定需求的第三方库。

pip 是 Python 开发中不可或缺的工具，可以协助开发者方便地获取和管理各种 Python 包和依赖项，提高开发效率和代码质量。

使用 pip 的详细教程主要包括几个基本步骤：安装 pip（如果尚未安装）、使用 pip 安装包、升级包、卸载包以及管理依赖。这里是一个逐步指南，适用于 Python 初学者。

### 2、详细教程步骤

1. 检查  pip 是否已安装（大多数现代 Python 版本自动包含 pip ）
   1. Windows 操作系统是命令提示符、Linux 是终端，输入如下命令
   2. ```Bash
      pip --version
      ```

   3. MacOS 操作系统输入如下命令
   4. ```Bash
      pip3 --version
      ```
2. 安装 pip 步骤
   1. [下载 get-pip.py 脚本](https://bootstrap.pypa.io/get-pip.py)
   2. 在命令行中，切换到包含 get-pip.py 脚本的目录。运行如下代码
   3. ```Bash
      python get-pip.py
      ```
3. 使用 pip 安装包，如：安装名为 requests 的包，运行如下代码

```Bash
pip install requests
```

​	4.命令行中查找特定包的信息，运行如下代码

```Bash
pip show requests
```

​	5.查看已安装的包及版本，运行如下代码

```Bash
pip list
```

​	6.升级包

1. 1. 升级已安装的包，运行如下代码

      ```Bash
      pip install --upgrade package-name
      ```

   2. 升级requests包，运行如下代码

2. ```Bash
   
   ```

​	7.卸载包

1. 卸载目前已有的包，运行如下代码
2. ```Bash
   pip uninstall package-name
   ```

3. 卸载  requests，运行如下代码
4. ```Bash
   pip uninstall requests
   ```

​	8.指定包版本号，运行如下代码	

```Bash
pip install openai==1.2.0
```

​	9.使用  requirements.txt 管理依赖（在大的项目中，通常会存在多个依赖。 pip 允许你使用一个 requirements.txt  文件来管理这些依赖）

1. 创建 requirements.txt ，运行 pip freeze 来获取当前环境的所有包及其版本，并将这些信息保存到  requirements.txt 文件中，运行如下代码
2. ```Bash
   pip freeze > requirements.txt
   ```

3. 安装 requirements.txt 中的依赖，列出所有的包，运行如下代码
4. ```Bash
   pip install -r requirements.txt
   ```

​	10.如 pip 不可用或损坏，运行如下代码

```Bash
python -m ensurepip --upgrade
```

### 3、pip 常用命令集合

```Bash
pip install /path/to/package #安装一个本地的Python包
pip install -r requirements.txt #从requirements.txt文件中安装包
pip cache purge #清理缓存
pip install package_name==version_number #安装指定版本的包
pip install --upgrade package_name #升级已安装的包
pip install --user package_name #这将在用户的本地目录中安装该库
pip install --no-dependencies package_name #安装名为xx的Python包但忽略其依赖项
pip install --find-links=URL package_name #从指定的URL中找到并安装名为"myproject的Python包
```

## 本地运行代码

### 1、安装 Python 运行环境

1. 1. 如上

### 2、配置 OpenAI 环境变量

1. 获取通过 DevAGI 赠送的 OpenAI API key
2. 操作步骤
   1. 本地创建一个新文件夹（文件夹命名最好是英文、文件夹内无其他文件）
   2. 打开编辑器（VScode）→打开刚才创建的“文件夹”
   3. 在项目文件夹里，创建一个名为 `.env` 的文件
      1. 不是 .env.py
      2. 不是 xxx.env 
      3. `.env`文件确认要保存（macOS系统： command+s）
      4. VSCode 编辑器，看一下当前文件上面是否有小圆点，如果有代表没有保存
3. 输入如下代码
   1. `sk-xxx` 使用自己的 key 替换（[获取key使用教程](https://www.yuque.com/agi/seed/base)）
   2. `OPENAI_BASE_URL` 
      1. 不是 OPENAI_API_BASE  
      2. 不是 OPENAI_API_URL
      3. `OPENAI_BASE_URL`的值是 `https://api.fe8.cn/v1`（`/v1`不要漏掉）
      4. `OPENAI_BASE_URL`是访问 OpenAI 的代理跳板，已解决网络通道问题
      5. ```Bash
         OPENAI_API_KEY="sk-xxx"
         OPENAI_BASE_URL="https://api.fe8.cn/v1"
         ```
4. 注意事项
   1. 关闭：梯子、魔法、科学上网
   2. 无需在命令行或 Windows 的全局环境配置变量。如果你配置了，你需要自己明白这意味着什么
   3. OpenAi 常见问题手册参考：[ OpenAI -常见问题](https://agiclass.feishu.cn/wiki/Ra7WwczijiY85XkbqSpcvE2Nn3f) 

### 3、安装包 pip

1. 安装 pip 详情见：[包管理工具-pip](https://agiclass.feishu.cn/wiki/HTU0wX2oQiu6C9kt9FMcsnGBnIf) 
2. 安装项目依赖的包
   
   macOS 系统
   
   ```Bash
   pip3 install python-dotenv openai    
   ```
   
   Windows 系统
   
   ```Bash
   pip install python-dotenv openai    
   ```

### 4、创建源代码文件

1. 在编辑器（VSCode）里，新建名为 `index.py` 的文件
2. 复制如下代码在 index.py 文件中

```Python
import os
from openai import OpenAI

# 加载 .env 到环境变量
from dotenv import load_dotenv, find_dotenv
_ = load_dotenv(find_dotenv())

# 配置 OpenAI 服务

client = OpenAI()

response = client.chat.completions.create(
    messages=[
        {
            "role": "user",
            "content": "讲个笑话",
        }
    ],
    model="gpt-3.5-turbo",
)

print(response)

# print(print(response.choices[0].message.content))  # 更具体的的打印
```

1. 运行代码，在`index.py` 的文件，运行 Python 代码
   1. 保存 .env文件
   2. 确保为最新的 Python 版本
   3. 查看运行代码结果
   4. 
2. 官方 OpenAI key （自己去OpenAI官方注册的key）

注意：这是在 OpenAI 官方注册的key才能使用，如果你用DevAGI的key，请不要使用。

1. 如果你有 OpenAI 的官方 key，并可以畅通访问 OpenAI 的网络
2. 需修改 `.env` 文件里的 `OPENAI_API_KEY` 为你自己的 key，并删除 `OPENAI_BASE_URL`
3. 如果你需要通过代理访问 OpenAI，那么需要配置 `OPENAI_BASE_URL` 为你的代理地址
4. 再次提醒：如果你使用 DevCTO的key，不要用这个代理地址。

```Bash
OPENAI_API_KEY="sk-xxx" # OpenAI 官方的 key
OPENAI_BASE_URL="https://a.xairun.com/v1" # 国内的代理地址,再次提醒：如果你使用 DevCTO的key，不要用这个地址。
```