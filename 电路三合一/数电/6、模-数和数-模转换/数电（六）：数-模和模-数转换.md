# 数电（六）：数-模和模-数转换

## 1、概述

- 主要性能指标
  - 转换精度
  - 转换速度
- 分类
  - D/A转换器（DAC）
    - 权电阻网络DAC、倒T形电阻网络DAC、权电流型DAC、权电容型DAC、开关树型DAC
  - A/D转换器（ADC）
    - 直接ADC：直接转换成数字量
    - 间接ADC：先转换成时间、频率等中间变量，再转换成数字量
  - 其他分类方式：
    - DAC：并行输入、串行输入
    - ADC：并行输出、串行输出



## 2、DAC

- 原理
  $$
  D_n=d_{n-1}d_{n-2}...d_1d_0=2^{n-1}d_{n-1}+2^{n-2}d_{n-2}+...+2^1d_1+2^0d_0
  $$

  - 其中 $2^{n-1}、2^{n-2}、...、2^1、2^0$ 称为最高位（Most Significant Bit **MSB**）到最低位（Least Significant Bit **LSB**）的权

### ①权电阻网络DAC

<img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\权电阻网络DAC.png" style="zoom: 20%;" />

- $S_0-S_3$ ：模拟开关，其开关状态受输入数码 $d_0-d_3$ 的取值控制

- 权电流
  $$
  I_i=\frac{V_{REF}}{R_i}\begin{cases}
  I_0=\frac{V_{REF}}{2^3R}\\
  I_1=\frac{V_{REF}}{2^2R}\\
  I_2=\frac{V_{REF}}{2^1R}\\
  I_3=\frac{V_{REF}}{2^0R}\\
  \end{cases}
  $$

- 取 $R_F=\frac R2\\$ ，则输出：
  $$
  v_0=-\frac{V_{REF}}{2^4}(2^3d_3+2^2d_2+2^1d_1+2^0d_0)
  $$

  - **输出电压的最大变化范围是 $0-\frac{2^n-1}{2^n}V_{REF}\\$** 
  - **若想输出电压为正值，则取 $V_{REF}$ 为负值**



### ②DAC的转换精度与转换速度

- 转换精度

  - 分辨率
    $$
    \frac1{2^n-1}
    $$

  - 转换误差

    - 原因

      - 参考电压 $V_{REF}$ 的波动
      - 运算放大器的零点漂移
      - 模拟开关的导通内阻、导通压降
      - 电阻网络中电阻阻值的偏差
      - 三极管特性不一致

      

    - 一般用最低有效位的倍数表示
    
      - $1LSB$ 表示输出的模拟电压与理论值之间的绝对误差 ≤ 输入为00...01时的输出电压
      - 若要求DAC的精度小于0.05%，一般要求绝对误差小于 $\frac12LSB\\$
      - 有时用电压满刻度FSR（Full Scale Range）的百分数表示

      

    - 分类

      - 比例系数误差

        - 由 $V_{REF}$ 偏离标准值造成

        - 所引起的误差和输入数字量大小成正比

        - 图像斜率变化

          <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\比例系数误差.png" style="zoom: 50%;" />

      - 漂移误差（平移误差、失调误差）

        - 由运算放大器的零点漂移造成

        - 所引起的误差与输入数字量大小无关

        - 图像上下平移

          <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\失调误差.png" style="zoom: 50%;" />

      - 非线性误差
    
        - 由模拟开关的导通内阻、导通压降造成
    
          <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\非线性误差.png" style="zoom: 50%;" />



- 转换速度

  - 当DAC输入的数字量发生变化时，输出的模拟量需要一段建立时间 $t_{set}$ 来响应

  - $t_{set}$ ：从输入的数字量发生突变开始，直到输出电压进入与稳态值相差 $±\frac12LSB\\$ 范围以内所用的时间

    <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\建立时间.png" style="zoom: 15%;" />

    - 不含运算放大器则最小为 $0.1\mu s$ 以内，包含运算放大器则最小为 $1.5\mu s$ 以内




## 3、ADC

### ①基本原理

- 取样、保持、量化、编码

- 取样定理

  - 若 $f_S$ 为取样信号频率，$f_{i(max)}$ 为输入模拟信号的最高频率分量的频率，则必须满足
    $$
    f_s\geq2f_{i(max)}\\
    一般取f_s=(3-5)f_{i(max)}
    $$

  - 在取样电路每次取得的模拟信号转换为数字信号时都需要一定的时间,而且为了给后续的量化编码提供一个稳定值，则每次取得的模拟信号必须通过保持电路保持一段时间。一般取样和保持过程往往是通过取样-保持电路同时完成的



- 量化和编码

  - 量化

    - 将模拟信号转换为数字量

    - 数字量最小单位所对应的最小量值叫做量化单位$\Delta$

    - 将采样-保持电路的输出电压归化为量化单位$\Delta$的整数倍

    - 量化方式

      - 只舍不入量化方式
        - 以3位ADC为例：
          - 设输入电压 $v_I$ 为 $0$~$1V$ 
          - 取量化单位 $\Delta=\frac18V\\$
          - 最大量化误差为 $\Delta$

      <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\只舍不入量化方式.png" style="zoom: 15%;" />

      - 四舍五入量化方式
        - 以3位ADC为例：
          - 设输入电压 $v_I$ 为 $0$~$1V$ 
          - 取量化单位 $\Delta=\frac2{15}V\\$
          - 最大量化误差为 $\frac12\Delta\\$

      <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\四舍五入量化方式.png" style="zoom:15%;" />

  - 编码

    - 用二进制代码来表示各个量化电平
    - 量化过程产生的误差为量化误差，属于原理误差，无法消除
    - 当输入的模拟电压为正负范围内变化时，一般采用二进制补码的形式编码



### ②并联比较型ADC

- 与反馈比较型ADC都属于直接ADC

  <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\并联比较型ADC.png" style="zoom: 67%;" />

- 由电压比较器、寄存器、代码转换电路三部分组成

  - 不包含取样-保持电路，即假定输入的模拟电压 $v_I$ 为取样-保持电路的输出电压

- 输入为 $0-V_{REF}$ 间的模拟电压

- 输出为3位二进制代码 $d_2d_1d_0$

- 量化方式

  - 取量化单位 $\Delta=\frac2{15}V\\$

    <img src="D:\Study\Note\电路三合一\数电\6、模-数和数-模转换\photos\并联比较型ADC代码转换表.png" style="zoom: 15%;" />

- 工作原理
  $$
  \begin{cases}
  d_2=Q_4\\
  d_1=Q_6+\bar Q_4 Q_2\\
  d_0=Q_7+\bar Q_6 Q_5+\bar Q_4Q_3+ \bar Q_2Q_1
  \end{cases}
  $$

- 特点

  - 优点
    - 速度快，转换时间 $50ns$ 以下
    - 不用取样-保持电路，因为比较器和寄存器有这样的功能
  - 缺点
    - 需要较多电压比较器和触发器 （$2^n-1$个）
  - 转换精度主要取决于量化电平的划分，且精度越高需要的比较器和触发器的数目越多



### ③ADC的转换精度与转换速度

- 分辨率
  - 表示ADC对输入信号的分辨能力
  - 一般以输出的位数表示
  - n位二进制数字输出的ADC能区分 $2^n$ 不同等级的输入模拟电压，能区分输入电压的最小值为 $\frac{FSR}{2^n}\\$（FSR为输入电压满量程刻度）
  - 在最大输入电压一定时，其输出位数越多，量化误差越小，分辨率越高
    - 如10位二进制ADC，若最大输入信号为 $5V$ ，则能区分输入信号的最小电压为 $\frac{5V}{2^{10}}=4.88mV\\$
- 转换误差
  - 表示ADC实际输出的数字量与理论输出的数字量的误差
  - 一般以最低有效位的倍数给出
    - 若转换误差为 $<±\frac{LSB}2\\$，则说明实际输出的数字量和理论输出的数字量之间的最小误差小于最低有效位的半个字
    - 有时也用满量程输出的百分数给出
      - 如ADC输出为十进制 $3\frac12\\$ 位（三位半：三位0\~9，一位0\~1），若转换误差为 $±0.05\%FSR$ ，则满量程输出为1999，最大输出误差小于最低位的 $1$ 
- 转换速度
  - 定义为ADC从转换控制信号到来时起，到输出端得到稳定的数字信号所经过的时间

- 示例：

  - 某信号采集系统要求一片A/D转换器集成芯片在 $1s$ 内对 $16$ 个热电偶的输出电压分时进行A/D转换。已知热电偶输出电压范围为 $0-0.025V$（对应 $0-450^o$ 温度范围），需要分辨的温度为 $0.1^oC$，试问选用多少位的A/D转换器？转换时间是多少？
    $$
    温度分辨率：\frac{0.1}{450}=\frac1{4500}\\
    12位ADC分辨率：\frac1{2^{12}}=\frac1{4096}
    $$
    故应选择13位ADC

    $$
    转换时间：\frac1{16}=62.5ms
    $$
